[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "Weekly",
  "modified": "2025-06-22 00:06:03.786674",
  "module": "HR",
  "name": "Auto Promotion Eligibility",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "import frappe\nfrom frappe.utils import today, add_months\n\ndef execute():\n    employees = frappe.get_all(\"Employee\",\n        filters={\"status\": \"Active\"},\n        fields=[\"name\", \"date_of_joining\", \"eligible_for_promotion\"])\n\n    for emp in employees:\n        if emp.date_of_joining:\n            eligible_date = add_months(emp.date_of_joining, 9)\n            if eligible_date <= today() and not emp.eligible_for_promotion:\n                frappe.db.set_value(\"Employee\", emp.name, \"eligible_for_promotion\", 1)\n",
  "script_type": "Scheduler Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "Daily",
  "modified": "2025-06-22 00:05:51.257803",
  "module": "HR",
  "name": "Auto Promotion Notification",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "from frappe.utils import today, add_days, nowdate\nfrom frappe import get_all, get_doc\nfrom datetime import datetime\n\ndef send_auto_promotion_alert():\n    hr_emails = [\"hr@karenroses.com\", \"sammy@karenroses.com\"]  # update as needed\n    employees = frappe.get_all(\"Employee\", filters={\"status\": \"Active\"}, fields=[\"name\", \"employee_name\", \"designation\", \"date_of_joining\", \"reports_to\"])\n    \n    for emp in employees:\n        if not emp.date_of_joining:\n            continue\n        \n        doj = datetime.strptime(str(emp.date_of_joining), \"%Y-%m-%d\").date()\n        days_worked = (datetime.today().date() - doj).days\n        \n        if days_worked in [243, 244, 245, 246, 272, 273, 274, 278, 279]:\n            line_manager_email = \"\"\n            if emp.reports_to:\n                try:\n                    manager = frappe.get_doc(\"Employee\", emp.reports_to)\n                    line_manager_email = manager.company_email or manager.personal_email\n                except:\n                    pass\n            \n            subject = f\"[Auto Promotion Notice] {emp.employee_name} nearing 9 months of service\"\n            message = f\"\"\"\n            <p>Employee <b>{emp.employee_name}</b> ({emp.designation}) is approaching 9 months of service.</p>\n            <p><b>Date of Joining:</b> {emp.date_of_joining}</p>\n            <p><b>Days Worked:</b> {days_worked} days</p>\n            <p>Please prepare for review and promotion.</p>\n            \"\"\"\n            recipients = hr_emails\n            if line_manager_email:\n                recipients.append(line_manager_email)\n\n            frappe.sendmail(\n                recipients=recipients,\n                subject=subject,\n                message=message\n            )\n\nsend_auto_promotion_alert()\n",
  "script_type": "Scheduler Event"
 }
]