[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Leave Application",
  "enabled": 1,
  "modified": "2025-06-24 14:32:17.216674",
  "module": "Upande Kaitet",
  "name": "Leave Balance After Auto-Calculation",
  "script": "frappe.ui.form.on('Leave Application', {\n    total_leave_days(frm) {\n        calculate_leave_balance_after(frm);\n    },\n    leave_balance(frm) {\n        calculate_leave_balance_after(frm);\n    },\n    refresh(frm) {\n        calculate_leave_balance_after(frm);\n    }\n});\n\nfunction calculate_leave_balance_after(frm) {\n    if (frm.doc.leave_balance && frm.doc.total_leave_days) {\n        frm.set_value('leave_balance_after', frm.doc.leave_balance - frm.doc.total_leave_days);\n    } else {\n        frm.set_value('leave_balance_after', '');\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Leave Encashment",
  "enabled": 0,
  "modified": "2025-06-24 15:21:47.628370",
  "module": "Upande Kaitet",
  "name": "Leave Encashment Amount Auto-Calculation",
  "script": "frappe.ui.form.on('Leave Encashment', {\n    employee(frm) {\n        fetch_basic_pay(frm);\n    },\n    encashment_days(frm) {\n        calculate_encashment(frm);\n    },\n    basic_pay(frm) {\n        calculate_encashment(frm);\n    }\n});\n\nfunction fetch_basic_pay(frm) {\n    if (!frm.doc.employee) return;\n\n    frappe.call({\n        method: \"frappe.client.get_value\",\n        args: {\n            doctype: \"Salary Structure Assignment\",\n            filters: {\n                employee: frm.doc.employee,\n                docstatus: 1\n            },\n            fieldname: [\"base\"]\n        },\n        callback: function (r) {\n            if (r.message && r.message.base) {\n                frm.set_value(\"basic_pay\", r.message.base);\n                calculate_encashment(frm);\n            }\n        }\n    });\n}\n\nfunction calculate_encashment(frm) {\n    if (frm.doc.basic_pay && frm.doc.encashment_days) {\n        let daily_rate = frm.doc.basic_pay / 30;\n        frm.set_value(\"daily_rate\", daily_rate);\n        frm.set_value(\"encashment_amount\", daily_rate * frm.doc.encashment_days);\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "P9 Form",
  "enabled": 1,
  "modified": "2025-06-30 10:37:09.963985",
  "module": "Upande Kaitet",
  "name": "P9 Form",
  "script": "frappe.ui.form.on('P9 Form', {\n  employee: function(frm) {\n    if (frm.doc.employee) {\n      frappe.db.get_doc('Employee', frm.doc.employee).then(emp => {\n        frm.set_value('employee_name', emp.employee_name);\n        frm.set_value('designation', emp.designation);\n        frm.set_value('department', emp.department);\n        frm.set_value('employee_pin', emp.kra_pin);\n      });\n    }\n  },\n\n  refresh: function(frm) {\n    if (!frm.doc.__islocal) {\n      frm.add_custom_button('Generate from Salary Slips', () => {\n        frappe.call({\n          method: 'upande_kaitet.api.generate_p9_form',\n          args: {\n            p9_name: frm.doc.name\n          },\n          callback: function(r) {\n            if (!r.exc) {\n              frappe.show_alert({message: 'P9 Form populated!', indicator: 'green'});\n              frm.reload_doc();\n            }\n          }\n        });\n      });\n    }\n  }\n});\n",
  "view": "Form"
 }
]